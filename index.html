<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <title>ç­ç´šç©åˆ†éŠ€è¡Œ</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #f8f9fa; font-family: "Microsoft JhengHei", sans-serif; }
    .card-score { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .nav-pills .nav-link.active { background-color: #764ba2; }
    .nav-pills .nav-link { color: #764ba2; }
    .loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.8); z-index: 9999; justify-content: center; align-items: center; }
    .auction-img { height: 150px; object-fit: cover; width: 100%; }
    .price-tag { color: #d9534f; font-weight: bold; font-size: 1.2em; }
    .rule-box { background: #fff; border-left: 5px solid #764ba2; padding: 15px; margin-bottom: 15px; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .rule-title { font-weight: bold; color: #333; font-size: 1.1em; display: flex; align-items: center; gap: 8px; }
  </style>
</head>
<body>

<div class="container py-4" style="max-width: 600px;">
  
  <div id="loading" class="loading">
    <div class="spinner-border text-primary" role="status"></div>
  </div>

  <div id="login-page" class="card shadow p-4">
    <h3 class="text-center mb-4">ğŸ” 106ç­ç©åˆ†éŠ€è¡Œç™»å…¥</h3>
    <div class="mb-3">
      <label class="form-label">åº§è™Ÿ</label>
      <input type="number" id="login-seat" class="form-control" placeholder="è¼¸å…¥åº§è™Ÿ">
    </div>
    <div class="mb-3">
      <label class="form-label">å¯†ç¢¼</label>
      <input type="password" id="login-pwd" class="form-control" placeholder="è¼¸å…¥å¯†ç¢¼">
    </div>
    <button onclick="doLogin()" class="btn btn-primary w-100">ç™»å…¥</button>
    <div class="text-center mt-4">
      <img src="https://meee.com.tw/wmJKWSV.jpg" class="img-fluid" style="max-width: 100%; border-radius: 10px;">
    </div>
  </div>

  <div id="main-page" style="display: none;">
    <div class="card card-score shadow mb-3">
      <div class="card-body text-center">
        <h5 class="card-title"><span id="user-name">åŒå­¸</span> æ‚¨å¥½</h5>
        <p class="card-text small">ç¸½ç©åˆ†</p>
        <h1 class="display-4 fw-bold" id="user-score">0</h1>
        <button onclick="logout()" class="btn btn-sm btn-outline-light mt-2">ç™»å‡º</button>
      </div>
    </div>

    <ul class="nav nav-pills nav-fill mb-3">
      <li class="nav-item"><button class="nav-link active" onclick="switchTab('logs')">ğŸ“œ åŠ æ‰£ç´€éŒ„</button></li>
      <li class="nav-item"><button class="nav-link" onclick="switchTab('auction')">ğŸ ç«¶æ¨™æœƒå ´</button></li>
      <li class="nav-item"><button class="nav-link" onclick="switchTab('rules')">â„¹ï¸ ä½¿ç”¨èªªæ˜</button></li>
    </ul>

    <div id="tab-logs">
      <div class="list-group" id="logs-list"></div>
    </div>

    <div id="tab-auction" style="display: none;">
      <div class="d-flex justify-content-end mb-2">
        <button class="btn btn-sm btn-outline-secondary" onclick="loadAuctions()">ğŸ”„ åˆ·æ–°åƒ¹æ ¼</button>
      </div>
      <div class="row g-3" id="auction-list"></div>
    </div>

    <div id="tab-rules" style="display: none;">
      <div class="rule-box">
        <div class="rule-title">ğŸ’° ç©åˆ†æ€éº¼ä¾†ï¼Ÿ</div>
        <p class="text-muted small mt-2 mb-0">
          è€å¸«æœƒæ ¹æ“šå¤§å®¶çš„è¡¨ç¾ï¼ˆå¦‚ï¼šä½œæ¥­ç¹³äº¤ã€æ‰“æƒèªçœŸã€èª²å ‚è¡¨ç¾ç­‰ï¼‰é€²è¡ŒåŠ æ‰£åˆ†ã€‚ä½ çš„ç¸½åˆ†ä»£è¡¨ä½ ç›®å‰æ“æœ‰çš„æ‰€æœ‰è³‡ç”¢ã€‚
        </p>
      </div>

      <div class="rule-box">
        <div class="rule-title">ğŸ”¨ ç«¶æ¨™è¦å‰‡ (èµ·æ‰‹ç„¡å›)</div>
        <p class="text-muted small mt-2 mb-0">
          1. ç«¶æ¨™æ¡<strong>ã€Œå…¬é–‹å‡ºåƒ¹ã€</strong>ï¼Œä½ å¿…é ˆå‡ºæ¯”ç›®å‰æœ€é«˜åƒ¹æ›´é«˜çš„åˆ†æ•¸ã€‚<br>
          2. <strong>ä¸€æ—¦å‡ºåƒ¹æˆåŠŸï¼Œä¸å¯æ’¤éŠ·ï¼</strong>è«‹çœ‹æ¸…æ¥šå†æŒ‰ã€‚<br>
          3. æˆªæ­¢æ™‚é–“åˆ°ï¼Œç”±æœ€é«˜å‡ºåƒ¹è€…å¾—æ¨™ã€‚
        </p>
      </div>

      <div class="rule-box" style="border-left-color: #d9534f;">
        <div class="rule-title">â„ï¸ ç‚ºä»€éº¼æˆ‘ä¸èƒ½å‡ºåƒ¹ï¼Ÿ(å‡çµè¦å‰‡)</div>
        <p class="text-muted small mt-2 mb-0">
          ç‚ºäº†é˜²æ­¢ç ´ç”¢ï¼Œç³»çµ±æœƒè¨ˆç®—ä½ çš„<strong>ã€Œå¯ç”¨é¤˜é¡ã€</strong>ã€‚<br>
          <br>
          <strong>å…¬å¼ï¼šç¸½ç©åˆ† - å…¶ä»–é ˜å…ˆå•†å“çš„é‡‘é¡ = å¯ç”¨é¤˜é¡</strong><br>
          <br>
          <em>èˆ‰ä¾‹ï¼šä½ æœ‰ 100 åˆ†ã€‚ä½ ç›®å‰æ­£åœ¨é ˜å…ˆã€Œé£²æ–™(40åˆ†)ã€ã€‚<br>
          é‚£ä½ åªå‰©ä¸‹ 60 åˆ†å¯ä»¥å»æ¨™åˆ¥çš„æ±è¥¿ã€‚<br>
          å¦‚æœä½ æƒ³æ¨™çš„æ±è¥¿è¦ 70 åˆ†ï¼Œç³»çµ±å°±æœƒé¡¯ç¤ºç©åˆ†ä¸è¶³ã€‚</em>
        </p>
      </div>

      <div class="rule-box">
        <div class="rule-title">ğŸ“¦ å¾—æ¨™å¾Œæ€éº¼æ‰£åˆ†ï¼Ÿ</div>
        <p class="text-muted small mt-2 mb-0">
          ç«¶æ¨™ç•¶ä¸‹ç³»çµ±<strong>ä¸æœƒ</strong>ç«‹åˆ»æ‰£åˆ†ï¼ˆåªæœƒå‡çµé¡åº¦ï¼‰ã€‚<br>
          ç›´åˆ°æ´»å‹•æˆªæ­¢ï¼Œè€å¸«ç¢ºèªå¾—æ¨™åå–®å¾Œï¼Œæœƒæ‰‹å‹•å¾å¾Œå°çµ±ä¸€æ‰£é™¤åˆ†æ•¸ï¼Œä¸¦ç™¼æ”¾çå“ã€‚
        </p>
      </div>
      <div class="text-center text-muted small mt-4">Â© 2025 ç­ç´šç©åˆ†éŠ€è¡Œç³»çµ±</div>
    </div>
  </div>
</div>

<script>
  const GAS_URL = "https://script.google.com/macros/s/AKfycbyM4ys5HiOSdgZjxbb2Oj_ScBR_hU2yCRpQfryoDsNvyRTx2pzNmvEe8tMvLr9XfEGZrQ/exec";
  let currentUser = {};

  function callGas(action, params, callback) {
    let url = `${GAS_URL}?action=${action}`;
    if (typeof callback === 'string') { url += `&callback=${callback}`; } 
    else if (typeof callback === 'function') {
      const tempName = 'cb_' + Math.floor(Math.random() * 1000000);
      window[tempName] = function(res) { callback(res); delete window[tempName]; };
      url += `&callback=${tempName}`;
    }
    for (let key in params) { url += `&${key}=${encodeURIComponent(params[key])}`; }
    const script = document.createElement('script'); script.src = url; document.body.appendChild(script);
  }

  function doLogin() {
    const seat = document.getElementById('login-seat').value;
    const pwd = document.getElementById('login-pwd').value;
    if(!seat || !pwd) { alert("è«‹è¼¸å…¥å®Œæ•´è³‡è¨Š"); return; }
    showLoading(true);
    callGas('login', {seat: seat, pwd: pwd}, function(res){
      showLoading(false);
      if(res.success) {
        currentUser = res; currentUser.seat = seat;
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('main-page').style.display = 'block';
        document.getElementById('user-name').innerText = res.name;
        document.getElementById('user-score').innerText = res.score;
        loadLogs();
      } else { alert(res.message); }
    });
  }

  function loadLogs() {
    showLoading(true);
    callGas('getLogs', {seat: currentUser.seat}, function(logs){
      showLoading(false);
      const list = document.getElementById('logs-list');
      list.innerHTML = logs.length ? "" : "<div class='text-center text-muted mt-3'>ç„¡ç´€éŒ„</div>";
      logs.forEach(log => {
        const color = log.score > 0 ? 'text-success' : 'text-danger';
        list.innerHTML += `<div class="list-group-item d-flex justify-content-between align-items-center">
          <div><small class="text-muted">${log.time}</small><br><strong>${log.reason}</strong></div>
          <span class="fs-5 fw-bold ${color}">${log.score > 0 ? '+' : ''}${log.score}</span>
        </div>`;
      });
    });
  }

  function loadAuctions() {
    showLoading(true);
    callGas('getAuctions', {}, function(items){
      showLoading(false);
      const list = document.getElementById('auction-list');
      list.innerHTML = items.length ? "" : "<div class='text-center text-muted mt-3'>ç›®å‰ç„¡ç«¶æ¨™</div>";
      items.forEach(item => {
        const imgHtml = item.img ? `<img src="${item.img}" class="card-img-top auction-img">` : '';
        const suggestPrice = Number(item.currentPrice) + 1;
        list.innerHTML += `<div class="col-12 col-md-6"><div class="card h-100 shadow-sm border-primary">${imgHtml}<div class="card-body"><h5 class="card-title">${item.name}</h5><div class="alert alert-light border text-center my-2"><small class="text-muted">ç›®å‰æœ€é«˜åƒ¹</small><br><span class="price-tag">${item.currentPrice}</span> åˆ†<br><small class="badge bg-info text-dark">${item.leader}</small></div><hr><div class="input-group"><input type="number" class="form-control" value="${suggestPrice}" id="bid-${item.id}"><button class="btn btn-primary" onclick="placeBid('${item.id}', '${item.name}')">å‡ºåƒ¹</button></div></div></div></div>`;
      });
    });
  }

  function placeBid(id, name) {
    const amount = document.getElementById('bid-'+id).value;
    if(!amount || amount <= 0) { alert("è«‹è¼¸å…¥æœ‰æ•ˆåˆ†æ•¸"); return; }
    if(!confirm(`ç¢ºå®šè¦å‡ºåƒ¹ ${amount} åˆ†å—ï¼Ÿ`)) return;
    showLoading(true);
    callGas('submitBid', { seat: currentUser.seat, name: currentUser.name, auctionId: id, auctionName: name, bidPrice: amount }, function(res){
      showLoading(false); alert(res.message);
      if(res.success) { loadAuctions(); callGas('login', {seat: currentUser.seat, pwd: ''}, function(u){ if(u.success) document.getElementById('user-score').innerText = u.score; }); }
    });
  }

  function logout() { location.reload(); }
  function switchTab(tab) {
    document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
    if (event) event.target.classList.add('active');
    document.getElementById('tab-logs').style.display = 'none';
    document.getElementById('tab-auction').style.display = 'none';
    document.getElementById('tab-rules').style.display = 'none';
    if(tab === 'logs') { document.getElementById('tab-logs').style.display = 'block'; loadLogs(); }
    else if(tab === 'auction') { document.getElementById('tab-auction').style.display = 'block'; loadAuctions(); }
    else if(tab === 'rules') { document.getElementById('tab-rules').style.display = 'block'; }
  }
  function showLoading(show) { document.getElementById('loading').style.display = show ? 'flex' : 'none'; }
</script>
</body>
</html>